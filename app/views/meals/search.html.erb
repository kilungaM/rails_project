<h1>Search Meals</h1>

<div class="card mb-4">
  <div class="card-body">
    <%= form_with url: search_meals_path, method: :get, local: true do |f| %>
      <div class="row">
        <div class="col-md-6 mb-3">
          <%= f.label :query, "Search by name, cuisine, or keywords" %>
          <%= f.text_field :query, value: @query, class: "form-control", placeholder: "e.g., Chicken, Italian, Spicy..." %>
        </div>
        <div class="col-md-4 mb-3">
          <%= f.label :category_id, "Filter by Category" %>
          <%= f.select :category_id,
                       options_from_collection_for_select(@categories, :id, :name, @category_id),
                       { include_blank: "All Categories" },
                       class: "form-select" %>
        </div>
        <div class="col-md-2 mb-3">
          <%= f.label :search, "&nbsp;".html_safe %>
          <%= f.submit "Search", class: "btn btn-primary w-100" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<% if @meals %>
  <h3>Search Results (<%= @meals.total_count %>)</h3>

  <% if @meals.any? %>
    <div class="row">
      <% @meals.each do |meal| %>
        <div class="col-md-3 mb-4">
          <div class="card h-100">
            <%= image_tag meal.thumb_url, class: "card-img-top", alt: meal.name if meal.thumb_url %>
            <div class="card-body">
              <h5 class="card-title"><%= meal.name %></h5>
              <p class="card-text">
                <span class="badge bg-secondary"><%= meal.category.name %></span><br>
                <span class="badge bg-info"><%= meal.area %></span>
              </p>
              <% if meal.review_count > 0 %>
                <p class="text-muted small"> <%= meal.average_rating %></p>
              <% end %>
              <%= link_to "View Recipe", meal_path(meal), class: "btn btn-sm btn-primary" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <div class="text-center mt-4">
      <%= paginate @meals %>
    </div>
  <% else %>
    <div class="alert alert-info">
      No meals found matching your search. Try different keywords!
    </div>
  <% end %>
<% end %>